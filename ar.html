<!--
	Project by Tavius Koktavy for Social Theory and Curatorial Practice, Fall 2018 NYU - github: https://github.com/kotavy/colorized-ar
	AR.js by @jerome_etienne - github: https://github.com/jeromeetienne/ar.js - info: https://medium.com/arjs/augmented-reality-in-10-lines-of-html-4e193ea9fdbf
-->

<head>
	<script src="https://aframe.io/releases/0.8.2/aframe.min.js"></script>
	<script src="https://cdn.rawgit.com/jeromeetienne/AR.js/1.6.2/aframe/build/aframe-ar.js"></script>
	<script>
		var urlFront = 'https://raw.githubusercontent.com/kotavy/colorized-ar/master/colorized-photos/';

		AFRAME.registerComponent('registerevents', {
			init: function() {
				var marker = this.el;
				var plane = marker.firstElementChild;
				marker.addEventListener('markerFound', function() {
					if (plane.parentElement.id == marker.id) { // Add only to the correct parent/child
						console.log("Adding click listener.");
						addClickListener(marker, plane);
						plane.addEventListener('click', function(evt) {
							clickResults(marker, plane);
						});
					}
				});
				marker.addEventListener('markerLost', function() {
					console.log('markerLost');
					if (plane.parentElement.id == marker.id) {
						plane.removeEventListener('click', clickResults);
						console.log("Click listener removed");
					}
				});
			}
		});

		function clickResults(marker, plane) {
			let imgSrc = plane.getAttribute('material').src.getAttribute('src'); // .src returns the object of the src ID. Get the src string of that img object.
			imgSrc = imgSrc.substring(imgSrc.indexOf('/') + 1);
			console.log(imgSrc);
			//window.location = urlFront + imgSrc;
		}

		// AFRAME.registerComponent('link-to-img', {
		// 	init: function() {
		// 		let el = this.el;
		// 		console.log(el.parentElement);
		// 		console.log(el.parentElement.getAttribute('registerevents'));
		// 		console.log(el.parentElement.getAttribute('registerevents').listening);
		//
		// 		el.addEventListener('click', function(evt) {
		// 			if (el.object3D.visible == true && evt.detail.cursorEl) {
		// 				let imgSrc = el.getAttribute('material').src.getAttribute('src'); // .src returns the object of the src ID. Get the src string of that img object.
		// 				imgSrc = imgSrc.substring(imgSrc.indexOf('/') + 1);
		// 				console.log(imgSrc);
		// 				//window.location = urlFront + imgSrc;
		// 			}
		// 		})
		// 	}
		// });

		// AFRAME.registerComponent('link-to-img2', {
		// 	init: function() {
		// 		let el = this.el; // NOTE, this code is buggy! It fires for every element with this component.
		// 		// Not sure how to resolve it generically, but there needs to be some check between the evt and this.el
		// 	},
		// 	tock: function() {
		// 		var listening = false;
		// 		let el = this.el;
		// 		if (el.object3D.visible && !listening) {
		// 			console.log("Seen");
		// 			listening = true;
		// 			el.addEventListener('click', function(evt) {
		// 				if (el.object3D.visible == true && evt.detail.cursorEl) {
		// 					//console.log(evt.detail);
		// 					//alert("Clicked"); // Debugging
		// 					let imgSrc = el.getAttribute('material').src.getAttribute('src'); // .src returns the object of the src ID. Get the src string of that img object.
		// 					imgSrc = imgSrc.substring(imgSrc.indexOf('/') + 1);
		// 					console.log(imgSrc);
		// 					window.location = urlFront + imgSrc;
		// 				}
		// 				if (el.object3D.visible == false) {
		//
		// 				}
		// 			});
		// 		}
		// 		if (!el.object3D.visible) {
		// 			console.log("gone");
		// 			listening = false;
		// 			el.removeEventListener('click');
		// 		}
		// 	}
		// });
	</script>
</head>

<body style='margin : 0px; overflow: hidden;'>
	<a-scene embedded arjs='debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;'>
		<a-assets>
			<img id="color1" src="colorized-photos/dust-bowl.jpg">
			<img id="color2" src="colorized-photos/migrant-family.jpg">
			<img id="color3" src="colorized-photos/irish-ellis-island.jpg">
			<img id="color4" src="colorized-photos/hooverville-central-park.jpg">
			<img id="color5" src="colorized-photos/family-on-road.jpg">
		</a-assets>

		<a-marker id='i' registerevents type='pattern' url='marker1.patt'>
			<!-- position="left<->right, far<->near, up<->down" -->
			<a-plane emitevents='true' cursor='rayOrigin: mouse; fuse: false' position='2 0 2.8' rotation='-90 0 0' width='5.332' height='4' material='side:double; src: #color1'>
			</a-plane>
		</a-marker>

		<a-marker id='ii' registerevents type='pattern' url='marker2.patt'>
			<a-plane emitevents='true' cursor='rayOrigin: mouse; fuse: false' position='2 0 2.8' rotation='-90 0 0' width='5.032' height='4' material='side:double; src: #color2'>
			</a-plane>
		</a-marker>

		<a-marker id='iii' registerevents type='pattern' url='marker3.patt'>
			<a-plane emitevents='true' cursor='rayOrigin: mouse; fuse: false' position='2 0 2.8' rotation='-90 0 0' width='5.124' height='4' material='side:double; src: #color3'>
		</a-marker>

		<a-marker id='iv' registerevents type='pattern' url='marker4.patt'>
			<a-plane emitevents='true' cursor='rayOrigin: mouse; fuse: false' position='2 0 2.8' rotation='-90 0 0' width='5.124' height='4' material='side:double; src: #color4'>
			</a-plane>
		</a-marker>

		<a-marker id='v' registerevents type='pattern' url='marker5.patt'>
			<a-plane emitevents='true' cursor='rayOrigin: mouse; fuse: false' position='2 0 2.8' rotation='-90 0 0' width='5.08' height='4' material='side:double; src: #color5' </a-plane>
		</a-marker>

		<a-entity camera></a-entity>
	</a-scene>
</body>